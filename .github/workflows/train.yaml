name: Trigger Training Job

on:
  workflow_run:
    workflows: [Build and Push Docker Image]
    types: [completed]
  workflow_dispatch:


jobs:
  trigger-training:
    runs-on: [self-hosted]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      
      - name: Trigger API Training Job
        run: |
          curl -X POST http://localhost:8000/train \
            -H "Content-Type: application/json" \
            -d '{
              "pr": "${{ github.event.pull_request.number || github.run_id }}",
              "repo": "${{ github.repository }}",
              "sha": "${{ github.sha }}",
              "image": "fdgdfgdgf123/train-img:${{ github.sha }}",
              "params": {
                "epochs": 5,
                "batch_size": 4,
                "lr": 0.001
              }
            }'