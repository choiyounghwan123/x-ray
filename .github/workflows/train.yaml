name: Trigger Training Job2

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  trigger-training:
    runs-on: [self-hosted]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      
      - name: Trigger API Training Job
        run: |
          curl -X POST http://localhost:8000/train \
            -H "Content-Type: application/json" \
            -d '{
              "pr": "${{ github.event.pull_request.number || github.run_id }}",
              "repo": "${{ github.repository }}",
              "sha": "${{ github.sha }}",
              "image": "fdgdfgdgf123/train-img:latest",
              "params": {
                "epochs": 5,
                "batch_size": 4,
                "lr": 0.001
              }
            }'